<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video FPS Converter Script (Unix)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #B6C2CF;
            background: #1d2125;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        h1, h2, h3 {
            margin-top: 24px;
            margin-bottom: 16px;
        }

        hr {
            height: 1px;
            background-color: #e1e4e8;
            border: none;
            margin: 24px 0;
        }

        blockquote {
            padding: 0 16px;
            color: #6a737d;
            border-left: 4px solid #dfe2e5;
            margin: 16px 0;
        }

        .warning {
            background-color: #8ac829;
            border-left-color: #9f40b5;
        }
        .warning p {
            color: #222;
            padding: 4px 4px 8px 4px;
        }

        .warning span {
            font-size: 26px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 16px;
        }

        th, td {
            border: 1px solid #dfe2e5;
            padding: 8px 12px;
            text-align: left;
        }

        th {
            background-color: #2c2c37;
        }

        code {
            font-family: SFMono-Regular, Consolas, 'Liberation Mono', Menlo, monospace;
            padding: 0.2em 0.4em;
            background-color: #101214;
            border-radius: 3px;
            font-size: 85%;
        }

        .code-wrapper {
            position: relative;
        }

        .copy-button {
            position: absolute;
            top: 5px;
            right: 5px;
            padding: 3px 8px;
            font-size: 12px;
            background-color: #2a2e32;
            color: #b6c2cf;
            border: 1px solid #444;
            border-radius: 4px;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.3s, background-color 0.3s;
        }

        .copy-button:hover {
            opacity: 1;
            background-color: #3a3e42;
        }

        pre {
            padding-top: 30px; /* Make space for the button */
        }

        pre {
            padding: 16px;
            overflow: auto;
            font-size: 85%;
            line-height: 1.45;
            background-color: #161a1d;
            border-radius: 3px;
            margin-bottom: 16px;
        }

        pre code {
            background-color: transparent;
            padding: 0;
        }

        .results {
            font-style: italic;
        }
    </style>
</head>
<body>
<!-- Add this at the end of your <body> section -->
<script>
    // Wrap all code blocks with a container div and add copy buttons
    document.addEventListener('DOMContentLoaded', function () {
        const codeBlocks = document.querySelectorAll('pre');

        codeBlocks.forEach(block => {
            // Create container
            const wrapper = document.createElement('div');
            wrapper.className = 'code-wrapper';

            // Create button
            const button = document.createElement('button');
            button.className = 'copy-button';
            button.textContent = 'Copy';

            // Add click event
            button.addEventListener('click', function () {
                const code = block.querySelector('code').textContent;
                navigator.clipboard.writeText(code).then(() => {
                    // Visual feedback
                    button.textContent = 'Copied!';
                    setTimeout(() => {
                        button.textContent = 'Copy';
                    }, 2000);
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                    button.textContent = 'Failed!';
                    setTimeout(() => {
                        button.textContent = 'Copy';
                    }, 2000);
                });
            });

            // Insert the button and wrapper
            block.parentNode.insertBefore(wrapper, block);
            wrapper.appendChild(block);
            wrapper.appendChild(button);
        });
    });
</script>
<h1>Video FPS Converter Script (Unix)</h1>

<p>This script batch-converts videos to a target frame rate (FPS) <strong>without dropping or duplicating
    frames</strong>, using <code>ffmpeg</code>.
    It works on Unix-like systems (Linux, macOS) and supports multiple formats and flexible configuration via
    command-line options.</p>

<blockquote class="warning">
    <p><span>⚠️</span>️ This script changes playback speed to match target FPS — <strong>no frames are dropped or
        interpolated</strong>.</p>
</blockquote>

<hr>

<h2>Features</h2>

<ul>
    <li>Works from any folder (no system-wide installation of <code>ffmpeg</code> required if you pass a custom binary
        path).
    </li>
    <li>Supports <code>.mp4</code>, <code>.mov</code>, <code>.avi</code>, <code>.mkv</code>, <code>.webm</code>.</li>
    <li>Removes audio by default (use <code>-k</code> to keep audio).</li>
    <li>CRF defines video quality:
        <ul>
            <li><code>0 = lossless</code></li>
            <li><code>18–23 = high quality (default: 18)</code></li>
            <li><code>28+ = lower quality</code></li>
            <li><code>51 = worst possible</code></li>
        </ul>
    </li>
    <li>New: optional bitrate mode computes a target video bitrate from the source file size and adjusted duration and uses <code>-b:v</code> instead of <code>-crf</code>.</li>
</ul>

<hr>

<h2>Supported Options</h2>

<table>
    <thead>
    <tr>
        <th>Option</th>
        <th>Description</th>
        <th>Example</th>
        <th>Default</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td><code>-d DIR</code></td>
        <td>Folder containing the source videos</td>
        <td><code>-d /path/to/videos</code></td>
        <td><code>.</code> (current directory)</td>
    </tr>
    <tr>
        <td><code>-f FPS</code></td>
        <td>Target output FPS</td>
        <td><code>-f 25</code></td>
        <td><code>25</code></td>
    </tr>
    <tr>
        <td><code>-k</code></td>
        <td>Keep audio (omit to remove audio)</td>
        <td><code>-k</code></td>
        <td>removed by default</td>
    </tr>
    <tr>
        <td><code>-c CRF</code></td>
        <td>Video quality (0–51, lower = better)</td>
        <td><code>-c 18</code></td>
        <td><code>18 (ignored because of -u)</code></td>
    </tr>
    <tr>
        <td><code>-p FFMPEG_PATH</code></td>
        <td>Path to <code>ffmpeg</code> binary</td>
        <td><code>-p /usr/local/bin/ffmpeg</code></td>
        <td><code>ffmpeg</code> (on PATH)</td>
    </tr>
    <tr>
        <td><code>-P FFPROBE_PATH</code></td>
        <td>Path to <code>ffprobe</code> binary</td>
        <td><code>-p /usr/local/bin/ffprobe</code></td>
        <td><code>ffprobe</code> (on PATH)</td>
    </tr>
    <tr>
        <td><code>-o OUTPUT_FOLDER</code></td>
        <td>Name of the output folder inside the input dir</td>
        <td><code>-o converted_out</code></td>
        <td><code>converted_fps_&lt;FPS&gt;</code></td>
    </tr>
    <tr>
        <td><code>-b AUDIO_BITRATE</code></td>
        <td>Audio bitrate in kbps (when keeping audio)</td>
        <td><code>-b 192</code></td>
        <td><code>192</code></td>
    </tr>
    <tr>
        <td><code>-u</code></td>
        <td>Use bitrate mode: compute target video bitrate and use <code>-b:v</code> instead of <code>-crf</code></td>
        <td><code>-u</code></td>
        <td>enabled</td>
    </tr>
    </tbody>
</table>

<hr>

<h2>Bitrate mode (\-u)</h2>

<p>When enabled with <code>-u</code>, the script computes a target video bitrate to keep approximate file size proportional to playback duration after the FPS change. The computation is:</p>

<ul>
    <li>original file size (bytes) = S</li>
    <li>original duration (seconds) = D</li>
    <li>source FPS = <code>src_fps</code></li>
    <li>target FPS = <code>tfps</code></li>
</ul>

<p><code>new_duration = D * (src_fps / tfps)</code></p>
<p><code>target_kbps = (S * 8) / new_duration / 1000</code></p>

<p>The script rounds to whole kbps and clamps to at least <code>1k</code>. If duration, fps, or file size detection fails the script will warn and fall back to CRF mode.</p>

<hr>

<h2>Usage</h2>

<p>Make the script executable:</p>
<pre><code>chmod +x ./convert_fps.sh</code></pre>

<p>or run with bash/sh:</p>
<pre><code>bash ./convert_fps.sh</code></pre>
<pre><code>sh ./convert_fps.sh</code></pre>

<hr>
<h3>⚠️ Bellows you'll see examples of usage with <code>sh</code></h3>

<p><strong>Basic example with the default parameters:</strong></p>
<pre><code>sh ./convert_fps.sh</code></pre>

<p><strong class="results">Results:</strong> video files are in the same folder as script, output folder with name
    <code>converted_fps_25</code> will be created, audio removed, target FPS is 25, video quality is high (CRF 18)</p>

<hr>

<p><strong>Keep audio:</strong></p>
<pre><code>sh ./convert_fps.sh -k</code></pre>

<p><strong class="results">Results:</strong> same as default parameters, but the audio is kept, audio bitrate is 192
    kbps.</p>

<p><strong>Use computed bitrate (bitrate mode):</strong></p>
<pre><code>sh ./convert_fps.sh</code></pre>

<p><strong class="results">Results:</strong> the script computes a target <code>-b:v</code> value based on file size and adjusted duration and uses that instead of CRF. If detection fails it falls back to CRF mode and prints warnings.</p>

<p><strong>Custom ffmpeg binary:</strong></p>
<pre><code>sh ./convert_fps.sh -p /usr/local/bin/ffmpeg</code></pre>

<p><strong class="results">Results:</strong> same as default parameters, but using custom ffmpeg binary.</p>

<p><strong>Full example (bitrate mode):</strong></p>
<pre><code>sh ./convert_fps.sh -d /media/videos -f 30 -k -u -p /usr/bin/ffmpeg -P /usr/bin/ffprobe -o converted_out -b 256</code></pre>

<p><strong class="results">Results:</strong></p>
<ul>
    <li><code>-d /media/videos</code> — input folder</li>
    <li><code>-f 30</code> — target FPS</li>
    <li><code>-k</code> — keep audio</li>
    <li><code>-u</code> — use computed video bitrate mode</li>
    <li><code>-p /usr/bin/ffmpeg</code> — custom ffmpeg binary path</li>
    <li><code>-p /usr/bin/ffprobe</code> — custom ffprobe binary path</li>
    <li><code>-o converted_out</code> — output folder name</li>
    <li><code>-b 256</code> — audio bitrate in kbps</li>
</ul>

<hr>

<h2>Notes</h2>

<ul>
    <li>The script detects source FPS from <code>ffmpeg -i</code> output and adjusts video playback speed
        (<code>setpts</code>) and audio tempo (<code>atempo</code>) to preserve frame order.
    </li>
    <li>When keeping audio, <code>atempo</code> filters are automatically decomposed into allowed ranges (0.5–2.0) as
        needed.
    </li>
    <li>Output files are written to <code>./&lt;INPUT_DIR&gt;/converted_fps_&lt;FPS&gt;</code> by default (or the folder
        provided with <code>-o</code>).
    </li>
    <li>Bitrate mode attempts to preserve approximate resulting file size relative to play time after FPS adjustment. Actual quality/size will vary depending on source complexity and encoder settings.</li>
    <li>If bitrate mode cannot determine duration, fps, or file size, the script will warn and fall back to CRF mode.</li>
</ul>
</body>
</html>
